@page "/"
@page "/{ChatHistoryId:long}"


<MudGrid>
    <MudItem xs="12">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.h4">
                Code Converter
            </MudText>
        </MudPaper>
    </MudItem>
</MudGrid>
@if (User is null)
{
    <MudAlert Severity=Severity.Warning Icon="@Icons.Material.Outlined.Warning">
        An Open AI API key has not been set. Retrieve an API key from the Open AI website, creating an account if necessary, and then navigate to <MudLink Href="settings">settings</MudLink> and add an API key.
    </MudAlert>
}
else
{
    <EditForm Model="_model" OnValidSubmit="OnValidSubmitAsync">
        <DataAnnotationsValidator />
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Class="pa-4">
                    <ChatWindow Conversation="CodeConverterState.Conversation" />
                </MudPaper>
            </MudItem>
        </MudGrid>
        <ChatOptionsDrawer Open=_isOptionsOpen>
            <MudGrid>
                <MudItem xs="12" Class="d-flex align-end">
                    <MudSelect @bind-Value=_model.Source Label="Source">
                        @foreach (var item in Enum.GetValues<ConvertCodeCommand.ConvertCodeOption>())
                        {
                            <MudSelectItem Value=item>@item.GetDisplayName()</MudSelectItem>
                        }
                    </MudSelect>
                    <MudIcon Icon="@Icons.Material.Outlined.ArrowForward" Class="mx-3"></MudIcon>
                    <MudSelect @bind-Value=_model.Destination Label="Destination">
                        @foreach (var item in Enum.GetValues<ConvertCodeCommand.ConvertCodeOption>())
                        {
                            <MudSelectItem Value=item>@item.GetDisplayName()</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>
            </MudGrid>
        </ChatOptionsDrawer>
        <ChatMessageBox @bind-Loading="@_isGenerating" @bind-Message="@_model.Code" MessageButtonText="Generate Code">
            <ToolbarContent>
                <MudIconButton Icon="@Icons.Material.Outlined.Menu" Color="Color.Primary" Variant="Variant.Filled" OnClick="ToggleOptions" />
                <FileUploadReader @bind-ReadContents="@_model.Code" Class="mt-0"/>
            </ToolbarContent>
        </ChatMessageBox>
@*        <GenerateTests @bind-IsGenerating="@_isGenerating" />*@
    </EditForm>
}